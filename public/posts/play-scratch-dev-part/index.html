<!DOCTYPE html>
<html>
  <head>
     
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
    <title>把玩Scratch - 开发篇 - Zezhen</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="Zezhen">
    <meta property="og:title" content="把玩Scratch - 开发篇"/>
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    <div class="head-title">
        <h4>Zezhen</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/Career/">Career</a><a class="category-link" href="/categories/Miscs/">Miscs</a><a class="category-link" href="/categories/Tech/">Tech</a><a class="category-link" href="/categories/%E6%97%85%E6%B8%B8/">旅游</a><a class="category-link" href="/categories/%E6%9D%82%E8%AE%B0/">杂记</a><a class="category-link" href="/categories/%E9%98%85%E8%AF%BB/">阅读</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>把玩Scratch - 开发篇</h2>
            <div class="post-meta">
                <time class="date">2018.09.28</time>
            
                <span class="category"><a class="category-link" href="/categories/Tech/">Tech</a></span>
            
            </div>
        </section>
        <article class="post-content">
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><img src="/img/scratch.jpg" width="450" height="570">

<p>前段时间心血来潮和朋友一起要搞个编程教育事业, 现在这块在国内还比较火, 学生家长也很愿意做这方面的投资, 前景看好, 那就试试呗. 我们选择从少儿初级教育入手, MIT开发的Scratch现在是大家普遍采用的解决方案, 它以组织砖块的形式来实现编程逻辑, 学生不需要任何编程基础, 只要简单动一动鼠标, 既可以完成动画, 音乐, 游戏等等的制作, 挺厉害的.</p>
<p>这里的开发指的是Scratch平台的开发, 毕竟针对国内市场, 从国内访问<a target="_blank" rel="noopener" href="https://scratch.mit.edu/projects/editor/?tip_bar=home">MIT的编辑器</a>还是有点慢, 需要移植一套环境, 然后部署到国内的服务器上, 这个任务自然就落到我头上, 如下简单的心路历程.</p>
<ol>
<li>Scratch现在有两个版本, 2.0是用Flash写的, 比较成熟, 3.0是用html5, 相对更轻量级, 但功能还在完善中, 所以考虑拿来即用的原则, 选择2.0版本</li>
<li>Flash从来没接触过, 虽然开发语言ActionScript 3.0很像JavaScript, 语法问题不大, 就是编译环境很是糟心, FlashBuilder, Flex, FlashDebug等等, 感觉是上古世纪的东西, 理不清, 折腾起来处处碰壁.</li>
<li><a target="_blank" rel="noopener" href="https://github.com/LLK/scratch-flash">scratch-flash</a>是2.0版本的源代码, 但只有基本功能的代码, 没有素材, 无法连接服务器, 没有分享功能等等, 这些都是必需的, 只能自己进行二次开发.</li>
<li>尝试几天却无果, 这就有点尴尬了, 不过运气还好, 找到了知乎上的一篇关于Flash Builder编译Scratch的介绍 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/32784825">link</a>, 按照步骤完成, 编译完后终于成功加载语言包 (之前在本地自己试的时候总是失败), 然后再阅读code, 结合其他人的成果, 就豁然开朗了.</li>
</ol>
<p><span style="font-style: italic;font-size:10pt;">有趣的是, 毫无头绪期间阅读到一片博文关于<a target="_blank" rel="noopener" href="https://www.213.name/archives/1033">Scratch二次开发</a>, 为了赶进度, 联系了博主, 希望能够合作, 过了两天等他回复的时候我已经知道怎么玩了, 向他简单请教了几句, 浪费对方时间了.</span></p>
<h2 id="Flash-Builder"><a href="#Flash-Builder" class="headerlink" title="Flash Builder"></a>Flash Builder</h2><p>Flash Builder可以从<a target="_blank" rel="noopener" href="https://helpx.adobe.com/download-install/kb/creative-cloud-apps-download.html">官网</a>下载, 是基于eclipse开发的, 还是熟悉的味道; 配置则参考知乎的<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/32784825">文章</a>, 编译成功后的文件是在bin-debug里面, 最重要的是Scratch.html和Scratch.swf, html是入口, 可以本地直接打开, 里面引用了swf文件, 当然还有参数配置, 比如素材文件等. 如下是过程中遇到的一些问题以及解决方案.</p>
<ol>
<li>Flash Builder 4.7破解, 可参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/taozoule/article/details/68942206">这个</a></li>
<li>在Mac Sierra上安装FlashBuilder的时候, 可能会遇到 “Install.app can’t be opened. You should eject the disk image.”问题, 可参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/41161024/adobe-creative-suit-5-cs5-5-installation-on-mac-os-sierra">这个</a></li>
<li><a target="_blank" rel="noopener" href="https://support.apple.com/kb/DL1572?locale=en_US">Legacy Java upgrade for Mac</a></li>
<li>另一篇介绍Scratch二次开发的<a target="_blank" rel="noopener" href="https://www.213.name/archives/1033">博文 - 鸽子博客</a></li>
<li>开发调试是很重要的部分, chrome上可以参考<a target="_blank" rel="noopener" href="https://helpx.adobe.com/flash-player/kb/enable-flash-player-content-debugger-in-google-chrome.html">Enable Flash Player Content Debugger in Google Chrome</a>, 不过我没有成功, 最后选择console.log的低效方法来调试.</li>
<li>编译产生的文件会自动放在bin-debug中, FB还支持export release, 如果导出的swf不可用, 可参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9544548/flex-4-5-bin-debug-works-but-bin-release-doesnt">这个</a></li>
<li>如何从html中调用swf时, 传递参数给swf文件, 可参考<a target="_blank" rel="noopener" href="https://helpx.adobe.com/flash/kb/pass-variables-swfs-flashvars.html">How to pass variables to SWF files for Flash Professional</a></li>
</ol>
<p><img src="/img/flash-builder.jpg"></p>
<h2 id="Gradle"><a href="#Gradle" class="headerlink" title="Gradle"></a>Gradle</h2><p>其实scratch-flash介绍使用gradle来编译scratch的, 不过最初因为一直不知道如何调用产生的swf文件, 才使用FB. FB的好处是自动生成了html-template (应该也是从源码中生成出来的, 还没找到对应的生成器), 编译后就能得到Scratch.html, 然后结合gradle编译产生的swf即可, 就无需FB这么庞大的存在了.</p>
<ol>
<li>在scratch-flash跟目录运行<code>./gradlew build -Ptarget=11.6</code>即可产生swf文件</li>
<li><a target="_blank" rel="noopener" href="https://gradle.org/">Gradle官网</a></li>
</ol>
<h2 id="Flash"><a href="#Flash" class="headerlink" title="Flash"></a>Flash</h2><p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Adobe_Flash">Flash</a>给人的感觉是骨灰级, 的确从1996年正式命名为flash开始, 而今已经走过22年的历史, 曾经一度是在线多媒体的霸主, 而它的将到2020年终止, 如下记录一些开发Flash遇到的一些问题.</p>
<ol>
<li>直接打开本地html调用swf的时候, 可能会遇到security error的问题, 可以修改settings, 参考<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/9184380/securityerror-error-2148-swf-file-file">这个</a></li>
<li>在浏览器中嵌入swf文件势必需要考虑javascript和flash的交互问题, Flash(AS3)利用ExternalInterface.call和ExternalInterface.addCallback来实现交互调用, 前者实现从AS3调用JS的function, 后者利用回调方法实现JS到AS3的调用, 解释和例子可参考<a target="_blank" rel="noopener" href="http://www.developmentshack.com/externalinterface-call-and-externalinterface-addcallback-not-working-in-ie-and-chrome-firefox-safari/121">AS3 ExternalInterface</a></li>
</ol>
<h2 id="视频转码"><a href="#视频转码" class="headerlink" title="视频转码"></a>视频转码</h2><p>Scratch提供录制视频功能, 但默认保存的是flv格式, 如果想通过手机分享的话, 就需要转码成mp4格式, 因此就需要处理视频转码问题. 刚开始用的视频转码神器<a target="_blank" rel="noopener" href="https://trac.ffmpeg.org/wiki/CompilationGuide/Centos">FFmpeg</a>, 花了蛮多时间安装, 了解编码格式, 好不容易搞定了, 但在本地转码性能实在有点接受不了, 几分钟的flv转成mp4需要十几二十分钟, 这完全超出可容能范围, 这时才突然想到阿里云应该会有这类服务, (域名和服务器都是阿里云上注册的, 万网已经接入到阿里云, 还有其他各种解决方案, 整体上非常方便), 一查的确有, 稍微学习了下, 转码非常好使而且速度很快, 高清窄带很适合现在手机屏幕, 早没有想到, 还是习惯性的自己搞定, 以至于浪费了好多时间.</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/doc-detail/53090.htm?spm=a2c63.p38356.a3.1.51672bf9LBzNMh">阿里云Python SDK快速入门</a></li>
<li><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/doc-detail/67664.htm?spm=a2c63.p38356.a3.11.34007c07quL1ez">转码Python API</a></li>
<li><a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/29208.html?spm=5176.2020520107.104.1.79c797da4X46O9">转码网页操作</a></li>
</ol>
<h2 id="阿里云CDN-x2F-OSS对象存储"><a href="#阿里云CDN-x2F-OSS对象存储" class="headerlink" title="阿里云CDN&#x2F;OSS对象存储"></a>阿里云CDN&#x2F;OSS对象存储</h2><p>在阿里云上租用的是轻量级应用服务器, 单核CPU, 1G内存, 20G硬盘, 如此低的配置感觉啥都干不了, 加载个3.2M的swf需要2分钟, 还有几百个素材, 等了老半天才搞定, 如果是并发请求的话, 估计要完. 需要升级服务器吗? 答案是否定的, 因为加载完swf文件后, 大部分处理逻辑都在浏览器端, 而服务器端的逻辑非常简单, 只是请求返回而已, 没太多计算需求, 考虑到阿里云有CDN和OSS存储, 服务器慢慢退化成了router.</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/doc-detail/27101.htm?spm=a2c63.p38356.a3.1.711622d1LNWun8">CDN</a>就不多介绍了, 内容分发网络, 针对中小文件图片非常适合, 可以认为是在服务器前加了一层cache, 能够大大提升文件访问的性能, 同时流量包年性价比很高.</li>
<li>OSS对象存储是转码时开通的, 次要需求, 因为前期用户不多, 20G虽小, 用用还是可以的, 素材也不多, 所以影响不大. 不过为了尽可能减少服务器端的压力, 以及把它完全变成router的设计, 就引入OSS, 将所有素材, 项目文件, 视频文件等保存在OSS对象存储中. 服务器的逻辑就变成了返回请求对象在oss上的链接, 由浏览器自己发起下载请求, 如此服务器可以达到较高的请求并发性能.</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/doc-detail/32027.htm?spm=a2c63.p38356.a3.4.339a3c71toHw8S">OSS Python API</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>花了点时间折腾Scratch, 从熟悉Flash开始, 到利用阿里云的一系列服务来帮助完成Scratch在线编辑器的功能, 这个过程中倒是学了不少, 除了完成一个小项目之外, 更重要的是信心的建立, 用工程师的思维来研究分析以及解决问题, 整合资源, 完成目标.</p>
<p>最后scratch online编辑器的链接: <a target="_blank" rel="noopener" href="http://scratch.svachina.com/">scratch online</a></p>
<h3 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h3><p>现在只有简单的Scratch编辑器, Scratch周边的功能还有待开发, 比如用户个人中心, 项目分享社区, 编程指导功能等等, 需要多花点时间完成, 再找些人一起.</p>

        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/posts/marriage/">婚姻</a></li>
                
                
                    <li>下一篇: <a href="/posts/interesting-scala/">Interesting Scala</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/education/" rel="tag">education</a><a class="-none-link" href="/tags/programming/" rel="tag">programming</a><a class="-none-link" href="/tags/scratch/" rel="tag">scratch</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="http://zezhen.me/favicon.ico" alt="Zezhen" />
            </figure>
        
            <div class="author-info">
                <h4>Zezhen</h4>
                <p>Be different and Make a difference</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/leader-as-coach/">Leader As Coach</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/grand-circle/">Grand Circle</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6-years-summary-best-practices/">工作技巧 -- 6年小总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6-years-summary-self-improvement/">自我成长 -- 6年小总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/996-icu/">996 ICU</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/learn-hotspot-problem/">learn hotspot problem</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">February 2010</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/bigdata/" style="font-size: 10px;">bigdata</a> <a href="/tags/career/" style="font-size: 16px;">career</a> <a href="/tags/china/" style="font-size: 12px;">china</a> <a href="/tags/coding/" style="font-size: 18px;">coding</a> <a href="/tags/communication/" style="font-size: 16px;">communication</a> <a href="/tags/culture/" style="font-size: 14px;">culture</a> <a href="/tags/distsys/" style="font-size: 12px;">distsys</a> <a href="/tags/education/" style="font-size: 10px;">education</a> <a href="/tags/essay/" style="font-size: 10px;">essay</a> <a href="/tags/food/" style="font-size: 10px;">food</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/history/" style="font-size: 14px;">history</a> <a href="/tags/howto/" style="font-size: 18px;">howto</a> <a href="/tags/human/" style="font-size: 12px;">human</a> <a href="/tags/hunman/" style="font-size: 10px;">hunman</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/leadership/" style="font-size: 10px;">leadership</a> <a href="/tags/learn/" style="font-size: 10px;">learn</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 12px;">linux</a> <a href="/tags/love/" style="font-size: 10px;">love</a> <a href="/tags/math/" style="font-size: 14px;">math</a> <a href="/tags/miscs/" style="font-size: 10px;">miscs</a> <a href="/tags/movie/" style="font-size: 10px;">movie</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/nature/" style="font-size: 10px;">nature</a> <a href="/tags/people/" style="font-size: 20px;">people</a> <a href="/tags/personality/" style="font-size: 10px;">personality</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/scratch/" style="font-size: 10px;">scratch</a> <a href="/tags/self/" style="font-size: 16px;">self</a> <a href="/tags/self-%E8%AE%A4%E7%9F%A5/" style="font-size: 10px;">self - 认知</a> <a href="/tags/social/" style="font-size: 14px;">social</a> <a href="/tags/stuff/" style="font-size: 10px;">stuff</a> <a href="/tags/summary/" style="font-size: 14px;">summary</a> <a href="/tags/thinking/" style="font-size: 10px;">thinking</a> <a href="/tags/travel/" style="font-size: 10px;">travel</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/%E8%AE%A4%E7%9F%A5/" style="font-size: 10px;">认知</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2022 <a href="/">Zezhen</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":false,"night":true});</script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
