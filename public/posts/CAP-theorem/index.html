<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>CAP Theorem | Zezhen</title><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/highlights/dracula.css"><link rel="canonical" href="http://zezhen.me/posts/CAP-theorem/"/>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><meta name="description" content="Goal of a System1The goal of a system is to provide a function quickly and correctly.  When the data and requests (read&#x2F;write) are…">
<meta property="og:type" content="article">
<meta property="og:title" content="CAP Theorem">
<meta property="og:url" content="http://zezhen.me/posts/CAP-theorem/">
<meta property="og:site_name" content="Zezhen">
<meta property="og:description" content="Goal of a System1The goal of a system is to provide a function quickly and correctly.  When the data and requests (read&#x2F;write) are…">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://zezhen.me/img/cap.jpeg">
<meta property="article:published_time" content="2019-03-16T22:21:43.000Z">
<meta property="article:modified_time" content="2022-05-31T07:01:05.760Z">
<meta property="article:author" content="Justin">
<meta property="article:tag" content="summary">
<meta property="article:tag" content="system">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://zezhen.me/img/cap.jpeg"><meta property="article:author" content="Justin"><meta property="twitter:label1" content="Published at"><meta property="twitter:data1" content="2019-03-16 15:21:43"><meta property="twitter:label2" content="Written by"><meta property="twitter:data2" content="Justin"><link rel="icon" href="/favicon.ico"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Zezhen"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body itemscope itemtype="https://schema.org/WebPage"><nav class="menu" id="menu"><div class="menu-inner"><div class="menu__left-area"><div class="menu__item"><a class="menu__item__link menu__item__link--brand" href="/" title="Home" rel="home"><img class="menu__item__link--brand__image" src="/favicon.ico" alt="Zezhen"><span class="menu__item__link--brand__label">Zezhen</span></a></div></div><div class="menu__right-area"><div class="menu__item"><a class="menu__item__link" href="/">Home</a></div><div class="menu__item"><a class="menu__item__link" href="/about">About</a></div></div></div></nav><div class="page-background"></div><div class="content-container"><div class="content-outer"><div class="content-inner" itemscope itemtype="https://schema.org/Blog"><article class="article" id="article" itemscope itemtype="https://schema.org/BlogPosting"><h1 class="article__title" itemprop="headline">CAP Theorem</h1><div class="article__meta"><time class="article__meta__time" datetime="2019-03-16T22:21:43.000Z" itemprop="datePublished">2019-03-16 15:21:43</time><div class="article__meta__categories"><a class="article__meta__categories__item" href="/categories/Tech/">Tech</a></div></div><hr><div class="article__contents"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="/img/cap.jpeg"></p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><h2 id="Goal-of-a-System"><a href="#Goal-of-a-System" class="headerlink" title="Goal of a System"></a>Goal of a System</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The goal of a system is to provide a function quickly and correctly.</span><br></pre></td></tr></table></figure>

<p>When the data and requests (read&#x2F;write) are in small scale, it’s easy to reach that in one node, which adaptable to store the data and handle all requests. However, things become complex along with the growing data and larger volume of requests.</p>
<h3 id="Availability-and-Partition"><a href="#Availability-and-Partition" class="headerlink" title="Availability and Partition"></a>Availability and Partition</h3><p>To continuously provide quick response of the function, we need to guarantee the good function <em>performance</em>, which means no downtime, low latency, etc, a.k.a. <em>Availability</em>. </p>
<p>Appreantly current one machine cannot store all data and handle all requests, therefore we have to scale both the data and requests to reach good availability. There are two directions as below, the easiness and effectiveness to scale data and requests is known as <em>Scalability</em>.</p>
<ol>
<li><em>Horizontal scaling</em>, which scales by adding more machines into your pool of resources<br> It’s easy to <em>scale out</em> by adding more machines, but has tradeoff due to CAP theorem limitation. Take the DB table as an example, scale out method splits different rows data into multiple tables or machines. Caution: carefully select the split points to avoid unbalanced data distribution.</li>
<li><em>Vertical scaling</em>, which scales by adding more power (CPU, RAM) to an existing machine.<br> One single machine has the upper limitation, <em>scale up</em> method uses more computation and storage support to solve the problem, it’s transparent to application. The cons are that the cost is higher and it needs another scale up once reach limitation again.</li>
</ol>
<p>If we hotizontally scale out the large scale of data into multiple parts according to some splitting mechanism, each machine can store one or more parts, each part of data is called <em>Partition</em>. Within each partition, we can provide full list of functions as like we are in baby step.</p>
<h3 id="Consistency"><a href="#Consistency" class="headerlink" title="Consistency"></a>Consistency</h3><p>Another aspect of the goal is function correctness, which depends on correctness of logic and data. Logic is in the application code and fixed before next update, while data is changing due to the operations like adding, removing or updating, etc. What’s more, data might be lost if the matchine is down. Therefore, we need some data protection methods to guarantee the data won’t be lost due to unexpect failure problems.</p>
<p><em>Replication</em> is one of practical ways, if the probability of data lost in one replica is $p$, then k replica lose data at same time will be $p^k$, condering p is a small number close to 0, thus $p^k$ is very very small number closing to zero, which means more replication can guarantee data safety in higher probability.</p>
<p>After we replicate one copy of data into multiple replications, we need to gantantee that at some time points the data in different replication should be same, otherwise the same logic read from different data will cause function discrepancy. We can use <em>Consistency</em> models<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Consistency model](https://en.wikipedia.org/wiki/Consistency_model)
">[1]</span></a></sup> to synchronize the data among multiple replications, there are two types of algorithms focus on differnet aspect to reach consistent state.</p>
<ol>
<li><em>Strong Consistency</em>. Only one consistent state can be observed by all parallel processes. Read more about linearizable<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Linearizability](https://en.wikipedia.org/wiki/Linearizability)
">[3]</span></a></sup> and sequential<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Sequential consistency](https://en.wikipedia.org/wiki/Sequential_consistency)
">[2]</span></a></sup> models.</li>
<li><em>Weak Consistency</em>. Different parallel processes can perceive variables in different states. Read more about data-centric consistency<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Data-Centric consistency](http://csis.pace.edu/~marchese/CS865/Lectures/Chap7/Chapter7fin.htm)
">[4]</span></a></sup>, causal consistency<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Causal consistency](https://en.wikipedia.org/wiki/Causal_consistency)
">[5]</span></a></sup> and eventual consistency<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Eventual consistency](https://en.wikipedia.org/wiki/Eventual_consistency)
">[6]</span></a></sup> models.</li>
</ol>
<p>As we can see above, if we use strong consistency model, all processes can observe one consistent state, but the tradeoff is that it needs to take some times to reach converged state, during this period, it’s hard to guarantee availability; or in another way, if we use weak consistency, parallel processes can perceive variables in different states, which cannot guarantee the function consistency or correctness all the time.</p>
<h2 id="CAP-Theorem"><a href="#CAP-Theorem" class="headerlink" title="CAP Theorem"></a>CAP Theorem</h2><p>The CAP theorem<sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[CAP Theorem](https://en.wikipedia.org/wiki/CAP_theorem)
">[7]</span></a></sup> states that it is impossible for a distributed data store to simultaneously provide more than two out of the following three guarantees:</p>
<ol>
<li><em>Consistency</em>: Every read receives the most recent write or an error</li>
<li><em>Availability</em>: Every request receives a (non-error) response – without the guarantee that it contains the most recent write</li>
<li><em>Partition tolerance</em>: The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes</li>
</ol>
<p>In particular, the CAP theorem implies that <em>in the presence of a network partition, one has to choose between consistency and availability.</em></p>
<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>No distributed system is safe from network failures, thus network partitioning generally has to be tolerated. In the presence of a partition, one is then left with two options: consistency or availability. When choosing consistency over availability, the system will return an error or a time-out if particular information cannot be guaranteed to be up to date due to network partitioning. When choosing availability over consistency, the system will always process the query and try to return the most recent available version of the information, even if it cannot guarantee it is up to date due to network partitioning.</p>
<p>Database systems designed with traditional <em>ACID</em> guarantees in mind such as RDBMS choose consistency over availability, whereas systems designed around the <em>BASE</em> philosophy, common in the NoSQL movement for example, choose availability over consistency. The <em>PACELC</em><sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[PACELC theorem](https://en.wikipedia.org/wiki/PACELC_theorem)">[8]</span></a></sup> theorem builds on CAP by stating that even in the absence of partitioning, another trade-off between latency and consistency occurs.</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Consistency_model">Consistency model</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Sequential_consistency">Sequential consistency</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Linearizability">Linearizability</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="http://csis.pace.edu/~marchese/CS865/Lectures/Chap7/Chapter7fin.htm">Data-Centric consistency</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Causal_consistency">Causal consistency</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Eventual_consistency">Eventual consistency</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/CAP_theorem">CAP Theorem</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/PACELC_theorem">PACELC theorem</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li></ol></div></div></div><div class="article__tags"><a class="article__tags__item" href="/tags/summary/">summary</a><a class="article__tags__item" href="/tags/system/">system</a></div><div class="article__author" itemscope itemprop="author" itemtype="https://schema.org/Person"><img class="article__author__image" src="/favicon.ico" alt="Justin"><a class="article__author__link" title="About Justin" rel="author">Justin</a><p class="article__author__desc">Be different and Make a difference</p><div class="article__author__socials"><a class="article__author__socials__item" href="/atom.xml" title="rss" target="_blank"><i class="fa fa-rss"></i></a></div><meta itemprop="name" content="Justin"></div><div class="sharer" id="sharer"><div class="sharer-inner"><div class="sharer__right"><button class="sharer__item" id="sharer-facebook"><i class="fa fa-facebook-official"></i></button><button class="sharer__item" id="sharer-twitter"><i class="fa fa-twitter"></i></button><button class="sharer__item" id="sharer-pinterest"><i class="fa fa-pinterest"></i></button><button class="sharer__item" id="sharer-pocket"><i class="fa fa-get-pocket"></i></button></div></div></div><!-- Disqus Code--><div id="disqus_thread"></div><script>(function() {
  var d = document, s = d.createElement('script');
  s.src = '//zezhen.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Enable JavaScript to see comments.</noscript><!-- Meta Tags for Structured Data--><meta itemprop="dateModified" content="2022-05-31T07:01:05.760Z"><meta itemprop="articleBody" content="
Goal of a System1The goal of a system is to provide a function quickly and correctly.

When the data and requests (read&amp;#x2F;write) are in small scale, it’s easy to reach that in one node, which..."><meta itemprop="url" content="http://zezhen.me/posts/CAP-theorem/"><meta itemprop="mainEntityOfPage" content="http://zezhen.me/posts/CAP-theorem/"><div itemscope itemtype="https://schema.org/Organization" itemprop="publisher"><meta itemprop="name" content="Zezhen"><div itemscope itemprop="logo" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="http://zezhen.me/favicon.ico"></div></div><div itemscope itemtype="https://schema.org/ImageObject" itemprop="image"><meta itemprop="contentUrl" content="http://zezhen.me/images/default.jpg"><meta itemprop="url" content="http://zezhen.me/images/default.jpg"><meta itemprop="width" content="1280"><meta itemprop="height" content="720"></div></article><section class="related-posts"><h3>Related posts</h3><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/posts/system-hotspot/"><div class="related-posts__item__background" style="background-image:url('/img/hotspots.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">System Hotspot</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/posts/6-years-summary-best-practices/"><div class="related-posts__item__background" style="background-image:url('/img/dao_yu_shu.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">工作技巧 -- 6年小总结</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/posts/6-years-summary-self-improvement/"><div class="related-posts__item__background" style="background-image:url('/img/yahoo.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">自我成长 -- 6年小总结</span></a></div></section></div></div></div><footer id="footer"><div class="widgets"><div class="widgets-inner"><!-- Jade doesn't support dynamic inclusion with `each`.--><!-- So, I just hard coded the file names that will be included.--><div class="widgets__item"><h3 class="widgets__item__heading">Archives</h3><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/">2013</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/">2010</a><span class="archive-list-count">2</span></li></ul><!--| !{list_archives({ type: 'monthly', format: theme.dateformat || 'MMMM YYYY' })}--></div><div class="widgets__item"><h3 class="widgets__item__heading">Categories</h3><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Career/">Career</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Miscs/">Miscs</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tech/">Tech</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%97%85%E6%B8%B8/">旅游</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%9D%82%E8%AE%B0/">杂记</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%98%85%E8%AF%BB/">阅读</a><span class="category-list-count">12</span></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Tag cloud</h3><div class="tag-cloud"><a href="/tags/bigdata/" style="font-size: 0.75rem;">bigdata</a> <a href="/tags/career/" style="font-size: 1.25rem;">career</a> <a href="/tags/china/" style="font-size: 0.88rem;">china</a> <a href="/tags/coding/" style="font-size: 1.38rem;">coding</a> <a href="/tags/communication/" style="font-size: 1.13rem;">communication</a> <a href="/tags/culture/" style="font-size: 1rem;">culture</a> <a href="/tags/education/" style="font-size: 0.75rem;">education</a> <a href="/tags/essay/" style="font-size: 0.75rem;">essay</a> <a href="/tags/food/" style="font-size: 0.75rem;">food</a> <a href="/tags/hadoop/" style="font-size: 0.75rem;">hadoop</a> <a href="/tags/hidden/" style="font-size: 0.75rem;">hidden</a> <a href="/tags/history/" style="font-size: 1rem;">history</a> <a href="/tags/howto/" style="font-size: 1.25rem;">howto</a> <a href="/tags/human/" style="font-size: 0.88rem;">human</a> <a href="/tags/hunman/" style="font-size: 0.75rem;">hunman</a> <a href="/tags/java/" style="font-size: 0.75rem;">java</a> <a href="/tags/leadership/" style="font-size: 0.75rem;">leadership</a> <a href="/tags/life/" style="font-size: 0.75rem;">life</a> <a href="/tags/linux/" style="font-size: 0.88rem;">linux</a> <a href="/tags/love/" style="font-size: 0.75rem;">love</a> <a href="/tags/math/" style="font-size: 1rem;">math</a> <a href="/tags/miscs/" style="font-size: 0.75rem;">miscs</a> <a href="/tags/movie/" style="font-size: 0.75rem;">movie</a> <a href="/tags/music/" style="font-size: 0.75rem;">music</a> <a href="/tags/nature/" style="font-size: 0.75rem;">nature</a> <a href="/tags/people/" style="font-size: 1.38rem;">people</a> <a href="/tags/personality/" style="font-size: 0.75rem;">personality</a> <a href="/tags/plan/" style="font-size: 0.75rem;">plan</a> <a href="/tags/scratch/" style="font-size: 0.75rem;">scratch</a> <a href="/tags/self/" style="font-size: 1.38rem;">self</a> <a href="/tags/social/" style="font-size: 1rem;">social</a> <a href="/tags/stuff/" style="font-size: 0.75rem;">stuff</a> <a href="/tags/summary/" style="font-size: 1.5rem;">summary</a> <a href="/tags/system/" style="font-size: 0.88rem;">system</a> <a href="/tags/thinking/" style="font-size: 0.75rem;">thinking</a> <a href="/tags/travel/" style="font-size: 0.75rem;">travel</a> <a href="/tags/unittest/" style="font-size: 0.75rem;">unittest</a></div></div></div></div><p class="copyright"><small>© 2022 Justin<br>Powered by <a href="https://hexo.io" rel="external" target="_blank">Hexo</a>, Theme by <a href="https://github.com/HyunSeob/hexo-theme-overdose" rel="external" target="_blank">Overdose</a></small></p></footer><script src="/js/sharer.min.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>