<!DOCTYPE html>
<html>
  <head>
     
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
    <title>learn CAP theorem - Zezhen</title>
    <link rel="shortcut icon" href="/static/img/icon.png">
    <link rel="icon" href="/static/img/icon.png" sizes="192x192"/>
    
<link rel="stylesheet" href="/static/kico.css">
<link rel="stylesheet" href="/static/hingle.css">

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FortAwesome/Font-Awesome/css/font-awesome.min.css">

    <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1"/>
    <meta property="og:site_name" content="Zezhen">
    <meta property="og:title" content="learn CAP theorem"/>
    
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

  <body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header>
    <div class="head-title">
        <h4>Zezhen</h4>
    </div>
    <div class="head-action">
        <div class="toggle-btn"></div>
        <div class="light-btn"></div>
        <div class="search-btn"></div>
    </div>
    <form class="head-search" method="post">
        <input type="text" name="s" placeholder="搜索什么？">
    </form>
    <nav class="head-menu">
        <a href="/">首页</a>
        <div class="has-child">
            <a>分类</a>
            <div class="sub-menu">
                <a class="category-link" href="/categories/Career/">Career</a><a class="category-link" href="/categories/Miscs/">Miscs</a><a class="category-link" href="/categories/Tech/">Tech</a><a class="category-link" href="/categories/%E6%97%85%E6%B8%B8/">旅游</a><a class="category-link" href="/categories/%E6%9D%82%E8%AE%B0/">杂记</a><a class="category-link" href="/categories/%E9%98%85%E8%AF%BB/">阅读</a>
            </div>
        </div>
        
            <a href="/about">关于我</a>
        
    </nav>
</header>

    <main>
    <div class="wrap min">
        <section class="post-title">
            <h2>learn CAP theorem</h2>
            <div class="post-meta">
                <time class="date">2019.03.16</time>
            
                <span class="category"><a class="category-link" href="/categories/Tech/">Tech</a></span>
            
            </div>
        </section>
        <article class="post-content">
            <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src="/img/cap.jpeg"></p>
<h2 id="Goal-of-a-System"><a href="#Goal-of-a-System" class="headerlink" title="Goal of a System"></a>Goal of a System</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The goal of a system is to provide a function quickly and correctly.</span><br></pre></td></tr></table></figure>

<p>When the data and requests (read&#x2F;write) are in small scale, it’s easy to reach that in one node, which adaptable to store the data and handle all requests. However, things become complex along with the growing data and larger volume of requests.</p>
<h3 id="Availability-and-Partition"><a href="#Availability-and-Partition" class="headerlink" title="Availability and Partition"></a>Availability and Partition</h3><p>To continuously provide quick response of the function, we need to guarantee the good function <em>performance</em>, which means no downtime, low latency, etc, a.k.a. <em>Availability</em>. </p>
<p>Appreantly current one machine cannot store all data and handle all requests, therefore we have to scale both the data and requests to reach good availability. There are two directions as below, the easiness and effectiveness to scale data and requests is known as <em>Scalability</em>.</p>
<ol>
<li><em>Horizontal scaling</em>, which scales by adding more machines into your pool of resources<br> It’s easy to <em>scale out</em> by adding more machines, but has tradeoff due to CAP theorem limitation. Take the DB table as an example, scale out method splits different rows data into multiple tables or machines. Caution: carefully select the split points to avoid unbalanced data distribution.</li>
<li><em>Vertical scaling</em>, which scales by adding more power (CPU, RAM) to an existing machine.<br> One single machine has the upper limitation, <em>scale up</em> method uses more computation and storage support to solve the problem, it’s transparent to application. The cons are that the cost is higher and it needs another scale up once reach limitation again.</li>
</ol>
<p>If we hotizontally scale out the large scale of data into multiple parts according to some splitting mechanism, each machine can store one or more parts, each part of data is called <em>Partition</em>. Within each partition, we can provide full list of functions as like we are in baby step.</p>
<h3 id="Consistency"><a href="#Consistency" class="headerlink" title="Consistency"></a>Consistency</h3><p>Another aspect of the goal is function correctness, which depends on correctness of logic and data. Logic is in the application code and fixed before next update, while data is changing due to the operations like adding, removing or updating, etc. What’s more, data might be lost if the matchine is down. Therefore, we need some data protection methods to guarantee the data won’t be lost due to unexpect failure problems.</p>
<p><em>Replication</em> is one of practical ways, if the probability of data lost in one replica is $p$, then k replica lose data at same time will be $p^k$, condering p is a small number close to 0, thus $p^k$ is very very small number closing to zero, which means more replication can guarantee data safety in higher probability.</p>
<p>After we replicate one copy of data into multiple replications, we need to gantantee that at some time points the data in different replication should be same, otherwise the same logic read from different data will cause function discrepancy. We can use <em>Consistency</em> models<sup id="fnref:1"><a href="#fn:1" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Consistency model](https://en.wikipedia.org/wiki/Consistency_model)
">[1]</span></a></sup> to synchronize the data among multiple replications, there are two types of algorithms focus on differnet aspect to reach consistent state.</p>
<ol>
<li><em>Strong Consistency</em>. Only one consistent state can be observed by all parallel processes. Read more about linearizable<sup id="fnref:3"><a href="#fn:3" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Linearizability](https://en.wikipedia.org/wiki/Linearizability)
">[3]</span></a></sup> and sequential<sup id="fnref:2"><a href="#fn:2" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Sequential consistency](https://en.wikipedia.org/wiki/Sequential_consistency)
">[2]</span></a></sup> models.</li>
<li><em>Weak Consistency</em>. Different parallel processes can perceive variables in different states. Read more about data-centric consistency<sup id="fnref:4"><a href="#fn:4" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Data-Centric consistency](http://csis.pace.edu/~marchese/CS865/Lectures/Chap7/Chapter7fin.htm)
">[4]</span></a></sup>, causal consistency<sup id="fnref:5"><a href="#fn:5" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Causal consistency](https://en.wikipedia.org/wiki/Causal_consistency)
">[5]</span></a></sup> and eventual consistency<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[Eventual consistency](https://en.wikipedia.org/wiki/Eventual_consistency)
">[6]</span></a></sup> models.</li>
</ol>
<p>As we can see above, if we use strong consistency model, all processes can observe one consistent state, but the tradeoff is that it needs to take some times to reach converged state, during this period, it’s hard to guarantee availability; or in another way, if we use weak consistency, parallel processes can perceive variables in different states, which cannot guarantee the function consistency or correctness all the time.</p>
<h2 id="CAP-Theorem"><a href="#CAP-Theorem" class="headerlink" title="CAP Theorem"></a>CAP Theorem</h2><p>The CAP theorem<sup id="fnref:7"><a href="#fn:7" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[CAP Theorem](https://en.wikipedia.org/wiki/CAP_theorem)
">[7]</span></a></sup> states that it is impossible for a distributed data store to simultaneously provide more than two out of the following three guarantees:</p>
<ol>
<li><em>Consistency</em>: Every read receives the most recent write or an error</li>
<li><em>Availability</em>: Every request receives a (non-error) response – without the guarantee that it contains the most recent write</li>
<li><em>Partition tolerance</em>: The system continues to operate despite an arbitrary number of messages being dropped (or delayed) by the network between nodes</li>
</ol>
<p>In particular, the CAP theorem implies that <em>in the presence of a network partition, one has to choose between consistency and availability.</em></p>
<h3 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h3><p>No distributed system is safe from network failures, thus network partitioning generally has to be tolerated. In the presence of a partition, one is then left with two options: consistency or availability. When choosing consistency over availability, the system will return an error or a time-out if particular information cannot be guaranteed to be up to date due to network partitioning. When choosing availability over consistency, the system will always process the query and try to return the most recent available version of the information, even if it cannot guarantee it is up to date due to network partitioning.</p>
<p>Database systems designed with traditional <em>ACID</em> guarantees in mind such as RDBMS choose consistency over availability, whereas systems designed around the <em>BASE</em> philosophy, common in the NoSQL movement for example, choose availability over consistency. The <em>PACELC</em><sup id="fnref:8"><a href="#fn:8" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="[PACELC theorem](https://en.wikipedia.org/wiki/PACELC_theorem)">[8]</span></a></sup> theorem builds on CAP by stating that even in the absence of partitioning, another trade-off between latency and consistency occurs.</p>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Consistency_model">Consistency model</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Sequential_consistency">Sequential consistency</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Linearizability">Linearizability</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="http://csis.pace.edu/~marchese/CS865/Lectures/Chap7/Chapter7fin.htm">Data-Centric consistency</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Causal_consistency">Causal consistency</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Eventual_consistency">Eventual consistency</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/CAP_theorem">CAP Theorem</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;"><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/PACELC_theorem">PACELC theorem</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li></ol></div></div>
        </article>
        <section class="post-near">
            <ul>
                
                    <li>上一篇: <a href="/posts/learn-hotspot-problem/">learn hotspot problem</a></li>
                
                
                    <li>下一篇: <a href="/posts/marriage/">婚姻</a></li>
                
            </ul>
        </section>
        
            <section class="post-tags">
            <a class="-none-link" href="/tags/distsys/" rel="tag">distsys</a><a class="-none-link" href="/tags/summary/" rel="tag">summary</a>
            </section>
        
    
        <section class="post-author">
        
            <figure class="author-avatar">
                <img src="http://zezhen.me/favicon.ico" alt="Zezhen" />
            </figure>
        
            <div class="author-info">
                <h4>Zezhen</h4>
                <p>Be different and Make a difference</p>
            </div>
        </section>
    
    </div>
</main>

    <footer>
    <div class="buttons">
        <a class="to-top" href="#"></a>
    </div>
    <div class="wrap min">
        <section class="widget">
            <div class="row">
                <div class="col-m-4">
                    <h3 class="title-recent">最新文章：</h3>
                    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/posts/leader-as-coach/">Leader As Coach</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/grand-circle/">Grand Circle</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6-years-summary-best-practices/">工作技巧 -- 6年小总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/6-years-summary-self-improvement/">自我成长 -- 6年小总结</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/996-icu/">996 ICU</a></li><li class="post-list-item"><a class="post-list-link" href="/posts/learn-hotspot-problem/">learn hotspot problem</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-date">时光机：</h3>
                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/11/">November 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/10/">October 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">May 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/04/">April 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">February 2010</a></li></ul>
                </div>
                <div class="col-m-4">
                    <h3 class="title-tags">标签云：</h3>
                    <a href="/tags/bigdata/" style="font-size: 10px;">bigdata</a> <a href="/tags/career/" style="font-size: 16px;">career</a> <a href="/tags/china/" style="font-size: 12px;">china</a> <a href="/tags/coding/" style="font-size: 18px;">coding</a> <a href="/tags/communication/" style="font-size: 16px;">communication</a> <a href="/tags/culture/" style="font-size: 14px;">culture</a> <a href="/tags/distsys/" style="font-size: 12px;">distsys</a> <a href="/tags/education/" style="font-size: 10px;">education</a> <a href="/tags/essay/" style="font-size: 10px;">essay</a> <a href="/tags/food/" style="font-size: 10px;">food</a> <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/history/" style="font-size: 14px;">history</a> <a href="/tags/howto/" style="font-size: 18px;">howto</a> <a href="/tags/human/" style="font-size: 12px;">human</a> <a href="/tags/hunman/" style="font-size: 10px;">hunman</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/leadership/" style="font-size: 10px;">leadership</a> <a href="/tags/learn/" style="font-size: 10px;">learn</a> <a href="/tags/life/" style="font-size: 10px;">life</a> <a href="/tags/linux/" style="font-size: 12px;">linux</a> <a href="/tags/love/" style="font-size: 10px;">love</a> <a href="/tags/math/" style="font-size: 14px;">math</a> <a href="/tags/miscs/" style="font-size: 10px;">miscs</a> <a href="/tags/movie/" style="font-size: 10px;">movie</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/nature/" style="font-size: 10px;">nature</a> <a href="/tags/people/" style="font-size: 20px;">people</a> <a href="/tags/personality/" style="font-size: 10px;">personality</a> <a href="/tags/programming/" style="font-size: 10px;">programming</a> <a href="/tags/scratch/" style="font-size: 10px;">scratch</a> <a href="/tags/self/" style="font-size: 16px;">self</a> <a href="/tags/self-%E8%AE%A4%E7%9F%A5/" style="font-size: 10px;">self - 认知</a> <a href="/tags/social/" style="font-size: 14px;">social</a> <a href="/tags/stuff/" style="font-size: 10px;">stuff</a> <a href="/tags/summary/" style="font-size: 14px;">summary</a> <a href="/tags/thinking/" style="font-size: 10px;">thinking</a> <a href="/tags/travel/" style="font-size: 10px;">travel</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/%E8%AE%A4%E7%9F%A5/" style="font-size: 10px;">认知</a>
                </div>
            </div>
        </section>
        <section class="sub-footer">
            <p>© 2022 <a href="/">Zezhen</a>. All Rights Reserved. Theme By <a href="https://github.com/Dreamer-Paul/Hingle" target="_blank" rel="nofollow">Hingle</a>.</p>
        </section>
    </div>
</footer>


<script src="/static/kico.js"></script>
<script src="/static/hingle.js"></script>


<script>var hingle = new Paul_Hingle({"copyright":false,"night":true});</script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
