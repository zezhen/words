
 <!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="UTF-8">
  
    <title>Unit Test Best Practices | this is zezhen</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="zezhen">
    

    
    <meta name="description" content="A good dev must be a good test!
The Value of Unit Tests
UTs give you confidence that your code works as you expect it to work, help in long-term development, such as code refactor.

UTs provide excel">
<meta property="og:type" content="article">
<meta property="og:title" content="Unit Test Best Practices">
<meta property="og:url" content="http://zezhen.github.io/posts/unit-test-best-practices/index.html">
<meta property="og:site_name" content="this is zezhen">
<meta property="og:description" content="A good dev must be a good test!
The Value of Unit Tests
UTs give you confidence that your code works as you expect it to work, help in long-term development, such as code refactor.

UTs provide excel">
<meta property="og:image" content="http://zezhen.github.io/img/unittest.jpg">
<meta property="og:updated_time" content="2016-03-04T07:57:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Unit Test Best Practices">
<meta name="twitter:description" content="A good dev must be a good test!
The Value of Unit Tests
UTs give you confidence that your code works as you expect it to work, help in long-term development, such as code refactor.

UTs provide excel">
<meta name="twitter:image" content="http://zezhen.github.io/img/unittest.jpg">

    
    <link rel="alternative" href="/atom.xml" title="this is zezhen" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="this is zezhen" title="this is zezhen"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="this is zezhen">this is zezhen</a></h1>
				<h2 class="blog-motto">starting here</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="Search" />
						<input type="hidden" name="q" value="site:zezhen.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/posts/unit-test-best-practices/" title="Unit Test Best Practices" itemprop="url">Unit Test Best Practices</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="zezhen" target="_blank" itemprop="author">zezhen</a>
		
  <p class="article-time">
    <time datetime="2013-10-15T18:13:00.000Z" itemprop="datePublished"> Published 2013-10-15</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#The-Value-of-Unit-Tests"><span class="toc-number">1.</span> <span class="toc-text">The Value of Unit Tests</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#How-to-Write-Unit-Tests"><span class="toc-number">2.</span> <span class="toc-text">How to Write Unit Tests</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#What-to-Test"><span class="toc-number">3.</span> <span class="toc-text">What to Test</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Properties-of-Well-Written-UT"><span class="toc-number">4.</span> <span class="toc-text">Properties of Well-Written UT</span></a></li></ol>
		
		</div>
		
		<p><img src="/img/unittest.jpg" width="250" height="250"></p>
<pre><code>A good dev must be a good test!
</code></pre><h1 id="The-Value-of-Unit-Tests"><a href="#The-Value-of-Unit-Tests" class="headerlink" title="The Value of Unit Tests"></a>The Value of Unit Tests</h1><ol>
<li><p>UTs give you confidence that your code works as you expect it to work, help in long-term development, such as code refactor.</p>
</li>
<li><p>UTs provide excellent implicit documentation because they show exactly how the code is designed to be used.</p>
</li>
<li><p>new members always begin with unit test, so well-written ut code is very helpful to understand existing project.</p>
</li>
</ol>
<h1 id="How-to-Write-Unit-Tests"><a href="#How-to-Write-Unit-Tests" class="headerlink" title="How to Write Unit Tests"></a>How to Write Unit Tests</h1><ol>
<li>Structure of UT code<ol>
<li>Set up all conditions for testing.<ol>
<li>necessary data should be created in test class, so that the tests don’t have to rely on external env.</li>
<li>mock up object or method call to get special result.<ul>
<li>PowerMockito is very powerful, an example show in appendix.</li>
</ul>
</li>
</ol>
</li>
<li>Call the method (or Trigger) being tested.</li>
<li>Verify that the results are correct.<ul>
<li>use assert statement to verify the result, if failed messages should be reported, the statement like “assert condition, message”.</li>
</ul>
</li>
<li>Clean up.<ul>
<li>Any used resource or modified records should be clean up, so this UT method can repeat without any latent error.</li>
</ul>
</li>
</ol>
</li>
<li>Make each test case method test just one thing<ol>
<li>Any given behaviour should be specified in one and only one test.</li>
<li>Otherwise if you later change that behaviour, you’ll have to change multiple tests.</li>
</ol>
</li>
<li>Name testcase method to indicate what it test<ol>
<li>a name should describe the subject, condition and result(optional),</li>
<li>for example: test_add_negative_positive(), from the name you can know this method is testing the add method with one negative and one positive input.</li>
<li>you need a good method name rather than comment</li>
</ol>
</li>
</ol>
<h1 id="What-to-Test"><a href="#What-to-Test" class="headerlink" title="What to Test"></a>What to Test</h1><ol>
<li>Inputs<ol>
<li>divide all possible input data into into different subsets, and choose several representatives from each subset, both valid and invalid input, so you can cover all of the conditions.</li>
<li>Normal conditions<ul>
<li>all the input make the code work right.</li>
</ul>
</li>
<li>Unexpected conditions<ol>
<li>The division, for example “a = b / c”, when “c=0” is a bad input;</li>
<li>The reference, for example “obj.call()”, when obj is null is bad;</li>
</ol>
</li>
</ol>
</li>
<li>Boundary condition (CORRECT)<ol>
<li>Conformance : Does the value conform to an expected format?</li>
<li>Ordering : Is the set of values ordered or unordered as appropriate?</li>
<li>Range: Is the value within reasonable minimum and maximum values?</li>
<li>Reference : Does the code refer anything external that isn’t under direct control of the code itself?</li>
<li>Existence: Does the value exist? (e.g. is non-null, non-zero, present in a set, etc)</li>
<li>Cardinality : Are there exactly enough values?</li>
</ol>
<ul>
<li>When testing an integer, a positive, negative and zero should be test, but if #1 have be test, there is no need to test 10 or 100, it’s enough.</li>
</ul>
<ol>
<li>Time: Is everything happening in order? At right time? In time?</li>
</ol>
</li>
<li>Other<ol>
<li>check Inverse relationship</li>
<li>cross-check using other means</li>
</ol>
</li>
</ol>
<h1 id="Properties-of-Well-Written-UT"><a href="#Properties-of-Well-Written-UT" class="headerlink" title="Properties of Well-Written UT"></a>Properties of Well-Written UT</h1><ol>
<li>Through<ol>
<li>cover as many lines of code as possible</li>
<li>cover each branch of conditional logic, including ternary operator.</li>
<li>cover as many paths as possible, it is seems a very big deal.</li>
</ol>
</li>
<li>Repeatable<ul>
<li>Every one of your unit tests should be able to be run repeatedly and continue to produce the same results, regardless of the environment in which the tests are being run.</li>
</ul>
</li>
<li>Independent<ul>
<li>make each test case independent to all the other</li>
</ul>
</li>
</ol>
<p>Appendix</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.powermock.api.mockito.PowerMockito;</span><br><span class="line"><span class="keyword">import</span> org.powermock.core.classloader.annotations.PrepareForTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockupRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@PrepareForTest</span>(Clz.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMethodMockUsingPowerMockito</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Clz c = PowerMockito.mock(Clz.class);</span><br><span class="line">        PowerMockito.when(c.func()).thenCallRealMethod();</span><br><span class="line">        PowerMockito.when(c, <span class="string">"call"</span>).thenReturn(<span class="number">1</span>);</span><br><span class="line">        c.func(); <span class="comment">// mock up call</span></span><br><span class="line">        <span class="keyword">new</span> Clz().func(); <span class="comment">// normal call</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Clz</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">int</span> rst = call();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(rst == <span class="number">0</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">"normal call"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">"mock up call"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://powermock.googlecode.com/svn/docs/powermock-1.3.7/apidocs/org/powermock/api/mockito/PowerMockito.html" target="_blank" rel="external">PowerMockito</a> uses a custom classloader and bytecode manipulation to enable mocking of static methods, constructors, final classes and methods, private methods, removal of static initializers and more.</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/coding/">coding</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/test/">test</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://zezhen.github.io/posts/unit-test-best-practices/" data-title="Unit Test Best Practices | this is zezhen" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/posts/java-code-standards/" title="Java Code Standards">
  <strong>上一篇：</strong><br/>
  <span>
  Java Code Standards</span>
</a>
</div>


<div class="next">
<a href="/posts/mapreduce-brief-explanation/"  title="MapReduce Brief Explanation">
 <strong>下一篇：</strong><br/> 
 <span>MapReduce Brief Explanation
</span>
</a>
</div>

</nav>

	

<section id="comments" class="comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="zezhen" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/bigdata/" title="bigdata">bigdata<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/coding/" title="coding">coding<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/life/" title="life">life<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/read/" title="read">read<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/stuff/" title="stuff">stuff<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">Tag Cloud</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/hadoop/" style="font-size: 10px;">hadoop</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/note/" style="font-size: 20px;">note</a> <a href="/tags/read/" style="font-size: 10px;">read</a> <a href="/tags/shopping/" style="font-size: 15px;">shopping</a> <a href="/tags/social/" style="font-size: 10px;">social</a> <a href="/tags/test/" style="font-size: 10px;">test</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://coolshell.cn/" target="_blank" title="CoolShell">CoolShell</a>
            
          </li>
        
          <li>
            
            	<a href="http://wuchong.me/jacman/" target="_blank" title="Jacman Theme">Jacman Theme</a>
            
          </li>
        
          <li>
            
            	<a href="https://zezhen.wordpress.com/" target="_blank" title="Justin">Justin</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hi there, welcome to my blog. <br/>
			Let&#39;s make the world better together.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/zezhen" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		<a href="https://www.linkedin.com/in/justin-lin-ab95255b" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="zezhen">zezhen</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>




<script type="text/javascript">

var disqus_shortname = 'zezhen';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>






<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
